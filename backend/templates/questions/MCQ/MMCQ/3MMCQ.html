{% extends 'testpage.html' %} 

{% block passage %}{% endblock %}

{% block options %}
<form id="myForm">
    <input type="checkbox" name="option" value="a">A<br>
    <input type="checkbox" name="option" value="b">B<br>
    <input type="checkbox" name="option" value="c">C<br>
</form>  

<script>
    function saveAndNext(test_id, attempt_id, question_no) {
        // Get the selected option value
        var selected_ans = [];
        $("input[name=option]:checked").each(function() {
            selected_ans.push($(this).val());
        });

        // Make the AJAX request to update the attempt
        $.ajax({
            type: "POST",
            url: "/api/update_attempt",
            data: JSON.stringify({
                test_id: test_id,
                attempt_id: attempt_id,
                question_no: question_no,
                selected_ans: selected_ans
            }),
            contentType: "application/json",
            dataType: "json",
            success: function(response) {
                // Handle the successful response
                console.log("Attempt updated successfully!");
                // Redirect to the next question
                redirectToTest(test_id, attempt_id, parseInt(question_no) + 1);
            },
            error: function(error) {
                // Handle any errors that occur during the request
                console.log("Error occurred during attempt update!");
                console.log(error);
            }
        });
    }

    function SaveAndSubmitAttempt(test_id, attempt_id, question_no) {
        // Get the selected option value
        var selected_ans = [];
        $("input[name=option]:checked").each(function() {
            selected_ans.push($(this).val());
        });

        // Make the AJAX request to update the attempt
        $.ajax({
            type: "POST",
            url: "/api/update_attempt",
            data: JSON.stringify({
                test_id: test_id,
                attempt_id: attempt_id,
                question_no: question_no,
                selected_ans: selected_ans
            }),
            contentType: "application/json",
            dataType: "json",
            success: function(response) {

                // On successfully updating current question selected ans, end attempt
                $.ajax({
                    type: "POST",
                    url: "/api/submit_attempt",
                    data: JSON.stringify({
                        attempt_id: attempt_id
                    }),
                    contentType: "application/json",
                    dataType: "json",
                    success: function(response) {
                        // Handle the successful response
                        console.log("Attempt ended successfully!");

                        // Redirect to the Performace Report page of attempt id
                        window.location.href = "/performancereport/"+attempt_id;
                    },
                    error: function(error) {
                        // Handle any errors that occur during the request
                        console.log("Error occurred during attempt ending!");
                        console.log(error);
                    }
                });

            },
            error: function(error) {
                // Handle any errors that occur during the request
                console.log("Error occurred during attempt update!");
                console.log(error);
            }
        });
    }
</script>
{% endblock %}